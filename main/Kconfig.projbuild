menu "PT100 Logger"

config APP_NODE_IS_ROOT
  bool "Build as mesh root node"
  default n
  help
    Root connects to the external Wi-Fi router, runs SNTP, and forwards incoming
    mesh packets over UART to the host.

config APP_WIFI_ROUTER_SSID
  string "Router SSID (root uses this to reach the Internet)"
  default ""
  help
    External Wi-Fi SSID used by the mesh root to get Internet for SNTP.

config APP_WIFI_ROUTER_PASSWORD
  string "Router password"
  default ""
  help
    External Wi-Fi password used by the mesh root.

config APP_MESH_DISABLE_ROUTER
  bool "Disable router backhaul (Mesh-Lite only mode)"
  default n
  help
    If enabled, the mesh root will not attempt to connect to an upstream router.
    Use this to form a routerless Mesh-Lite network with a fixed root.

config APP_SNTP_SERVER
  string "SNTP server"
  default "pool.ntp.org"

config APP_TIME_SYNC_PERIOD_S
  int "Root time broadcast period (seconds)"
  range 5 3600
  default 30

config APP_MESH_CHANNEL
  int "Mesh Wi-Fi channel"
  range 1 13
  default 6

config APP_MESH_ID_HEX
  string "Mesh ID (6 bytes hex, colon separated)"
  default "77:77:77:77:77:77"
  help
    Example: 77:77:77:77:77:77. All nodes must use the same Mesh ID.

config APP_MESH_AP_PASSWORD
  string "Mesh AP password (8+ chars)"
  default "pt100mesh"
  help
    Password used for the mesh SoftAP. Must be 8+ characters.

config APP_MESH_AP_CONNECTIONS
  int "Mesh AP max connections"
  range 1 10
  default 6

config APP_SPI_HOST
  int "SPI host (2=SPI2_HOST, 3=SPI3_HOST)"
  range 2 3
  default 2

config APP_SPI_MOSI_GPIO
  int "SPI MOSI GPIO"
  range -1 48
  default 11

config APP_SPI_MISO_GPIO
  int "SPI MISO GPIO"
  range -1 48
  default 13

config APP_SPI_SCLK_GPIO
  int "SPI SCLK GPIO"
  range -1 48
  default 12

config APP_MAX31865_CS_GPIO
  int "MAX31865 CS GPIO"
  range -1 48
  default 10

config APP_MAX7219_ENABLE
  bool "Enable MAX7219 32x8 display"
  default y

config APP_MAX7219_SPI_HOST
  int "MAX7219 SPI host (2=SPI2_HOST, 3=SPI3_HOST)"
  range 2 3
  default 3

config APP_MAX7219_MOSI_GPIO
  int "MAX7219 MOSI GPIO"
  range -1 48
  default 17

config APP_MAX7219_SCLK_GPIO
  int "MAX7219 SCLK GPIO"
  range -1 48
  default 18

config APP_MAX7219_CS_GPIO
  int "MAX7219 CS GPIO"
  range -1 48
  default 16

config APP_MAX7219_CHAIN_LEN
  int "MAX7219 chain length"
  range 1 8
  default 4

config APP_MAX7219_INTENSITY
  int "MAX7219 intensity (0-15)"
  range 0 15
  default 6

config APP_MAX7219_ROTATE_180
  bool "Rotate MAX7219 output 180 degrees"
  default n

config APP_MAX7219_MIRROR_X
  bool "Mirror MAX7219 output horizontally"
  default n

config APP_MAX7219_MIRROR_Y
  bool "Mirror MAX7219 output vertically"
  default n

config APP_MAX31865_RREF_OHMS
  int "MAX31865 reference resistor (ohms)"
  range 10 100000
  default 430

config APP_RTD_R0_OHMS
  int "RTD nominal resistance at 0°C (ohms)"
  range 10 100000
  default 100

config APP_MAX31865_BIAS_SETTLE_MS
  int "MAX31865 bias settle delay (ms)"
  range 0 500
  default 10
  help
    Extra delay after enabling VBIAS to allow RC filters on the RTD input to
    settle before starting a one-shot conversion.

choice APP_MAX31865_WIRES
  prompt "MAX31865 wiring mode"
  default APP_MAX31865_WIRES_4

config APP_MAX31865_WIRES_2
  bool "2-wire (highest lead error)"

config APP_MAX31865_WIRES_3
  bool "3-wire (lead compensation enabled)"

config APP_MAX31865_WIRES_4
  bool "4-wire (best accuracy)"

endchoice

choice APP_MAX31865_FILTER
  prompt "MAX31865 notch filter"
  default APP_MAX31865_FILTER_50HZ

config APP_MAX31865_FILTER_50HZ
  bool "50 Hz"

config APP_MAX31865_FILTER_60HZ
  bool "60 Hz"

endchoice

choice APP_MAX31865_CONVERSION
  prompt "RTD temperature conversion method"
  default APP_MAX31865_CONVERSION_TABLE_PT100

config APP_MAX31865_CONVERSION_TABLE_PT100
  bool "ITS-90 PT100 table (binary search + interpolation)"

config APP_MAX31865_CONVERSION_CVD_ITERATIVE
  bool "Callendar–Van Dusen iterative solve"

endchoice

config APP_SD_CS_GPIO
  int "SD card CS GPIO"
  range -1 48
  default 15

config APP_FRAM_SIZE_BYTES
  int "FRAM size in bytes"
  range 4096 33554432
  default 32768
  help
    Total size of the FRAM device. Used to compute circular buffer capacity.

config APP_FRAM_I2C_ADDR
  int "FRAM I2C address"
  range 0 127
  default 80
  help
    0x50 default address for MB85RC256V (A2/A1/A0 low). Shares the same I2C bus
    as the DS3231.

config APP_FRAM_HEADER_UPDATE_EVERY_N_RECORDS
  int "Persist FRAM header every N records"
  range 1 1000
  default 16
  help
    Header is written periodically to survive power loss without writing it on
    every record.

config APP_LOG_PERIOD_MS_DEFAULT
  int "Default logging period (ms)"
  range 100 3600000
  default 1000

config APP_FRAM_FLUSH_WATERMARK_RECORDS_DEFAULT
  int "Default flush watermark (records)"
  range 1 1000000
  default 1024
  help
    When buffered records in FRAM reach this watermark, the app will flush a batch
    of records to the SD card.

config APP_SD_BATCH_BYTES_TARGET
  int "Target SD batch size (bytes)"
  range 4096 262144
  default 8192
  help
    CSV flush batches are built up to roughly this many bytes before being
    appended to SD. Larger batches improve wear and throughput.

config APP_SD_PERIODIC_FLUSH_MS
  int "Periodic flush interval (ms)"
  range 1000 3600000
  default 3600000
  help
    Even if the FRAM watermark is not reached, the app will attempt to flush
    buffered records after this many milliseconds to keep latency bounded.

config APP_SD_TAIL_SCAN_BYTES
  int "Bytes to scan when repairing SD tail"
  range 4096 1048576
  default 262144
  help
    On boot or day rollover, the logger scans this many bytes from the end of
    the CSV file to find the last complete line and sequence number.

config APP_SD_FILE_BUFFER_BYTES
  int "Buffered FILE stream size for SD appends"
  range 4096 262144
  default 8096

config APP_I2C_SDA_GPIO
  int "I2C SDA GPIO (DS3231)"
  range -1 48
  default 7

config APP_I2C_SCL_GPIO
  int "I2C SCL GPIO (DS3231)"
  range -1 48
  default 8

config APP_DS3231_I2C_ADDR
  int "DS3231 I2C address"
  range 0 127
  default 104
  help
    104 decimal = 0x68.

config APP_DIAGNOSTICS_OVERRIDE_GPIO
  int "Diagnostics override GPIO (active high, -1 to disable)"
  range -1 48
  default -1
  help
    If set to a valid GPIO, holding the pin high at reset forces diagnostics
    boot mode regardless of the stored NVS boot mode.

endmenu
